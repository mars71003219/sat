# UML 다이어그램

## 📐 목차

1. [Use Case Diagram (유스케이스 다이어그램)](#use-case-diagram)
2. [Class Diagram (클래스 다이어그램)](#class-diagram)
3. [Sequence Diagram (시퀀스 다이어그램)](#sequence-diagram)
4. [Component Diagram (컴포넌트 다이어그램)](#component-diagram)
5. [Deployment Diagram (배포 다이어그램)](#deployment-diagram)
6. [Activity Diagram (활동 다이어그램)](#activity-diagram)
7. [State Diagram (상태 다이어그램)](#state-diagram)

---

## Use Case Diagram

### 시스템 사용자와 기능

```
                    인공위성 시계열 모니터링 시스템
┌──────────────────────────────────────────────────────────────────┐
│                                                                  │
│                                                                  │
│     ┌─────────────────────────────────────────────┐             │
│     │     실시간 데이터 모니터링                  │             │
│     │  ┌──────────────────────────────────┐      │             │
│     │  │ • 대시보드 조회                  │      │             │
│     │  │ • 메트릭 선택                    │◄─────┼─────────┐   │
│     │  │ • 시간 범위 설정                 │      │         │   │
│     │  │ • 위성 선택                      │      │         │   │
│     │  └──────────────────────────────────┘      │         │   │
│     │                                             │         │   │
│     │     ┌────────────────────────────┐         │     ┌───┴───┐
│     │     │ 트렌드 분석                │         │     │ 운영자 │
│     │     │ • 원본 vs 예측 비교        │◄────────┼─────│       │
│     │     │ • 통계 정보 확인           │         │     │ (Ops) │
│     │     └────────────────────────────┘         │     └───┬───┘
│     └─────────────────────────────────────────────┘         │   │
│                                                              │   │
│     ┌─────────────────────────────────────────────┐         │   │
│     │     AI 모델 추론                            │         │   │
│     │  ┌──────────────────────────────────┐      │         │   │
│     │  │ • 추론 요청 제출                 │◄─────┼─────────┤   │
│     │  │ • 모델 선택 (VAE/Transformer)    │      │         │   │
│     │  │ • 결과 조회                      │      │         │   │
│     │  │ • 성능 메트릭 확인               │      │         │   │
│     │  └──────────────────────────────────┘      │         │   │
│     └─────────────────────────────────────────────┘         │   │
│                                                              │   │
│     ┌─────────────────────────────────────────────┐         │   │
│     │     데이터 관리                             │         │   │
│     │  ┌──────────────────────────────────┐      │         │   │
│     │  │ • 데이터 수집 설정               │◄─────┼─────────┤   │
│     │  │ • 저장소 관리                    │      │         │   │
│     │  │ • 백업/복구                      │      │         │   │
│     │  └──────────────────────────────────┘      │         │   │
│     └─────────────────────────────────────────────┘         │   │
│                                                              │   │
│     ┌─────────────────────────────────────────────┐         │   │
│     │     시스템 모니터링                         │     ┌───┴───┐
│     │  ┌──────────────────────────────────┐      │     │ 관리자 │
│     │  │ • Kafka 큐 모니터링              │◄─────┼─────│       │
│     │  │ • Celery 작업 모니터링           │      │     │(Admin)│
│     │  │ • 시스템 헬스 체크               │      │     └───┬───┘
│     │  │ • 로그 확인                      │      │         │   │
│     │  └──────────────────────────────────┘      │         │   │
│     └─────────────────────────────────────────────┘         │   │
│                                                              │   │
│     ┌─────────────────────────────────────────────┐         │   │
│     │     데이터 시뮬레이션                       │     ┌───┴───┐
│     │  ┌──────────────────────────────────┐      │     │개발자 │
│     │  │ • 위성 데이터 생성               │◄─────┼─────│       │
│     │  │ • 시뮬레이션 파라미터 설정       │      │     │ (Dev) │
│     │  │ • 다중 위성 시뮬레이션           │      │     └───────┘
│     │  └──────────────────────────────────┘      │             │
│     └─────────────────────────────────────────────┘             │
│                                                                  │
│                                                                  │
│     ┌─────────────────────────────────────────────┐     ┌───────┐
│     │     API 연동                                │     │외부   │
│     │  ┌──────────────────────────────────┐      │     │시스템 │
│     │  │ • REST API 호출                  │◄─────┼─────│       │
│     │  │ • WebSocket 구독                 │      │     │       │
│     │  └──────────────────────────────────┘      │     └───────┘
│     └─────────────────────────────────────────────┘             │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘

         «include»                «extend»
  기본 흐름에 포함되는 기능    선택적으로 확장되는 기능
```

---

## Class Diagram

### 1. 데이터 모델 계층

```
┌─────────────────────────────────────────────────────────────────┐
│                      Domain Models                              │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────────────┐
│   SatelliteTelemetry         │
├──────────────────────────────┤
│ - timestamp: DateTime        │
│ - satellite_id: str          │
│ - metrics: Dict[str, float]  │
│ - location: Location         │
├──────────────────────────────┤
│ + to_kafka_message(): str    │
│ + from_kafka_message(): Self │
│ + validate(): bool           │
└──────────────────┬───────────┘
                   │
                   │ contains
                   ▼
         ┌─────────────────────┐
         │   Location          │
         ├─────────────────────┤
         │ - latitude: float   │
         │ - longitude: float  │
         ├─────────────────────┤
         │ + is_valid(): bool  │
         └─────────────────────┘

┌──────────────────────────────┐
│   InferenceJob               │
├──────────────────────────────┤
│ - job_id: UUID               │
│ - model_name: str            │
│ - status: JobStatus          │
│ - input_data: List[float]    │
│ - result: InferenceResult    │
│ - created_at: DateTime       │
│ - completed_at: DateTime     │
├──────────────────────────────┤
│ + submit(): None             │
│ + get_result(): Result       │
│ + cancel(): None             │
└──────────────┬───────────────┘
               │
               │ produces
               ▼
      ┌────────────────────────┐
      │  InferenceResult       │
      ├────────────────────────┤
      │ - predictions: List    │
      │ - mean_prediction: f   │
      │ - metrics: Dict        │
      ├────────────────────────┤
      │ + to_dict(): Dict      │
      └────────────────────────┘

┌──────────────────────────────┐
│   «enumeration»              │
│   JobStatus                  │
├──────────────────────────────┤
│ PENDING                      │
│ PROCESSING                   │
│ COMPLETED                    │
│ FAILED                       │
│ CANCELLED                    │
└──────────────────────────────┘
```

### 2. 서비스 계층

```
┌─────────────────────────────────────────────────────────────────┐
│                      Service Layer                              │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────┐
│   «interface»                        │
│   DataProducer                       │
├──────────────────────────────────────┤
│ + produce(topic, message): void      │
│ + flush(): void                      │
└──────────────┬───────────────────────┘
               │
               │ implements
               │
    ┌──────────┴──────────────────────────────────┐
    │                                             │
    ▼                                             ▼
┌───────────────────────┐            ┌─────────────────────────┐
│ SatelliteSimulator    │            │ KafkaProducer           │
├───────────────────────┤            ├─────────────────────────┤
│ - satellite_id: str   │            │ - bootstrap_servers: str│
│ - interval: float     │            │ - topic: str            │
│ - orbit_period: int   │            ├─────────────────────────┤
├───────────────────────┤            │ + send(message): void   │
│ + generate(): Telem   │            │ + close(): void         │
│ + run(): void         │            └─────────────────────────┘
└───────────────────────┘

┌──────────────────────────────────────┐
│   «interface»                        │
│   DataConsumer                       │
├──────────────────────────────────────┤
│ + consume(): Iterator[Message]       │
│ + subscribe(topics): void            │
│ + commit(): void                     │
└──────────────┬───────────────────────┘
               │
               │ implements
               ▼
┌─────────────────────────────────────┐
│ VictoriaMetricsConsumer             │
├─────────────────────────────────────┤
│ - kafka_config: Dict                │
│ - victoria_url: str                 │
│ - running: bool                     │
├─────────────────────────────────────┤
│ + start(): void                     │
│ + stop(): void                      │
│ + process_message(msg): void        │
│ - write_to_victoria(metrics): void  │
└─────────────────────────────────────┘

┌──────────────────────────────────────┐
│   InferenceService                   │
├──────────────────────────────────────┤
│ - triton_client: TritonClient        │
│ - celery_app: Celery                 │
├──────────────────────────────────────┤
│ + submit_job(job): UUID              │
│ + get_result(job_id): Result         │
│ + list_models(): List[str]           │
└──────────┬───────────────────────────┘
           │
           │ uses
           ▼
┌──────────────────────────────────────┐
│   TritonClient                       │
├──────────────────────────────────────┤
│ - url: str                           │
│ - model_name: str                    │
├──────────────────────────────────────┤
│ + infer(data): Array                 │
│ + get_model_metadata(): Dict         │
│ + is_model_ready(): bool             │
└──────────────────────────────────────┘
```

### 3. 저장소 계층

```
┌─────────────────────────────────────────────────────────────────┐
│                      Repository Layer                           │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────┐
│   «interface»                        │
│   Repository[T]                      │
├──────────────────────────────────────┤
│ + save(entity: T): T                 │
│ + find_by_id(id): Optional[T]        │
│ + find_all(): List[T]                │
│ + delete(id): void                   │
└──────────────┬───────────────────────┘
               │
               │ implements
    ┌──────────┴──────────────────────┐
    │                                 │
    ▼                                 ▼
┌────────────────────┐    ┌───────────────────────────┐
│ PostgresRepository │    │ VictoriaMetricsRepository │
├────────────────────┤    ├───────────────────────────┤
│ - connection       │    │ - base_url: str           │
│ - table_name       │    │ - timeout: int            │
├────────────────────┤    ├───────────────────────────┤
│ + execute(sql)     │    │ + query(promql): List     │
│ + transaction()    │    │ + write(metrics): void    │
└────────────────────┘    │ + delete(metric): void    │
                          └───────────────────────────┘

┌──────────────────────────────────────┐
│   CacheRepository                    │
├──────────────────────────────────────┤
│ - redis_client: Redis                │
│ - ttl: int                           │
├──────────────────────────────────────┤
│ + get(key): Optional[Any]            │
│ + set(key, value, ttl): void         │
│ + delete(key): void                  │
│ + exists(key): bool                  │
└──────────────────────────────────────┘
```

### 4. API 계층

```
┌─────────────────────────────────────────────────────────────────┐
│                      API Layer                                  │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────┐
│   FastAPIApplication                 │
├──────────────────────────────────────┤
│ - routers: List[APIRouter]           │
│ - middleware: List[Middleware]       │
├──────────────────────────────────────┤
│ + include_router(router): void       │
│ + add_middleware(mw): void           │
└──────────────┬───────────────────────┘
               │
               │ contains
    ┌──────────┴──────────────────────────────┐
    │                  │                      │
    ▼                  ▼                      ▼
┌──────────┐  ┌─────────────┐  ┌─────────────────┐
│Inference │  │TrendsRouter │  │DashboardRouter  │
│Router    │  ├─────────────┤  ├─────────────────┤
├──────────┤  │+ get_raw()  │  │+ get_stats()    │
│+ submit()│  │+ get_pred() │  │+ get_metrics()  │
│+ result()│  │+ compare()  │  └─────────────────┘
└──────────┘  │+ metrics()  │
              │+ satellites()│
              └─────────────┘

┌──────────────────────────────────────┐
│   «dataclass»                        │
│   TrendRequest                       │
├──────────────────────────────────────┤
│ + metric: str                        │
│ + start_time: DateTime               │
│ + end_time: DateTime                 │
│ + satellite_id: Optional[str]        │
├──────────────────────────────────────┤
│ + validate(): bool                   │
└──────────────────────────────────────┘

┌──────────────────────────────────────┐
│   «dataclass»                        │
│   TrendResponse                      │
├──────────────────────────────────────┤
│ + metric_name: str                   │
│ + data_points: List[DataPoint]       │
│ + summary: StatsSummary              │
├──────────────────────────────────────┤
│ + to_json(): str                     │
└──────────────────────────────────────┘
```

---

## Sequence Diagram

### 1. 위성 데이터 수집 및 저장 시퀀스

```
시뮬레이터     Kafka      Victoria      Victoria
             Broker     Consumer      Metrics
    │            │          │             │
    │─┐          │          │             │
    │ │ generate │          │             │
    │ │ telemetry│          │             │
    │<┘          │          │             │
    │            │          │             │
    │ produce    │          │             │
    │──────────>│          │             │
    │            │          │             │
    │            │<────┐    │             │
    │            │     │ poll           │
    │            │     │    │             │
    │            │ consume  │             │
    │            │─────────>│             │
    │            │          │             │
    │            │          │─┐           │
    │            │          │ │ parse     │
    │            │          │ │ message   │
    │            │          │<┘           │
    │            │          │             │
    │            │          │─┐           │
    │            │          │ │ format    │
    │            │          │ │ prometheus│
    │            │          │<┘           │
    │            │          │             │
    │            │          │  write      │
    │            │          │───────────>│
    │            │          │             │
    │            │          │      OK     │
    │            │          │<─────────────│
    │            │          │             │
    │            │          │─┐           │
    │            │          │ │ commit    │
    │            │          │ │ offset    │
    │            │          │<┘           │
    │            │          │             │
   ...          ...        ...           ...
```

### 2. AI 추론 요청 및 처리 시퀀스

```
Client    Operation   Celery    Analysis   Triton    PostgreSQL
         Server       Queue     Worker     Server
  │         │           │          │          │           │
  │ POST    │           │          │          │           │
  │ /submit │           │          │          │           │
  │────────>│           │          │          │           │
  │         │           │          │          │           │
  │         │─┐         │          │          │           │
  │         │ │ create  │          │          │           │
  │         │ │ job_id  │          │          │           │
  │         │<┘         │          │          │           │
  │         │           │          │          │           │
  │         │  enqueue  │          │          │           │
  │         │──────────>│          │          │           │
  │         │           │          │          │           │
  │  202    │           │          │          │           │
  │  job_id │           │          │          │           │
  │<────────│           │          │          │           │
  │         │           │          │          │           │
  │         │           │  dequeue │          │           │
  │         │           │<─────────│          │           │
  │         │           │          │          │           │
  │         │           │          │  infer   │           │
  │         │           │          │────────>│           │
  │         │           │          │          │           │
  │         │           │          │          │─┐         │
  │         │           │          │          │ │ forward │
  │         │           │          │          │ │ pass    │
  │         │           │          │          │<┘         │
  │         │           │          │          │           │
  │         │           │          │  result  │           │
  │         │           │          │<─────────│           │
  │         │           │          │          │           │
  │         │           │          │  save    │           │
  │         │           │          │──────────────────────>│
  │         │           │          │          │           │
  │         │           │          │         OK            │
  │         │           │          │<──────────────────────│
  │         │           │          │          │           │
  │         │           │  done    │          │           │
  │         │           │<─────────│          │           │
  │         │           │          │          │           │
  │  GET    │           │          │          │           │
  │ /result │           │          │          │           │
  │────────>│           │          │          │           │
  │         │           │          │          │           │
  │         │  query    │          │          │           │
  │         │──────────────────────────────────────────────>│
  │         │           │          │          │           │
  │         │                               result         │
  │         │<──────────────────────────────────────────────│
  │         │           │          │          │           │
  │  200    │           │          │          │           │
  │  result │           │          │          │           │
  │<────────│           │          │          │           │
  │         │           │          │          │           │
```

### 3. 트렌드 데이터 조회 시퀀스

```
Browser   Nginx    Frontend    Operation    Victoria
                               Server       Metrics
   │        │         │            │            │
   │  GET / │         │            │            │
   │───────>│         │            │            │
   │        │         │            │            │
   │        │  HTML   │            │            │
   │        │────────>│            │            │
   │<───────│         │            │            │
   │        │         │            │            │
   │        │         │─┐          │            │
   │        │         │ │ render   │            │
   │        │         │ │ mount    │            │
   │        │         │<┘          │            │
   │        │         │            │            │
   │        │         │ GET /trends/raw         │
   │        │         │────────────>│           │
   │        │         │            │            │
   │        │         │            │  PromQL    │
   │        │         │            │  query     │
   │        │         │            │──────────>│
   │        │         │            │            │
   │        │         │            │            │─┐
   │        │         │            │            │ │ scan
   │        │         │            │            │ │ TSDB
   │        │         │            │            │<┘
   │        │         │            │            │
   │        │         │            │   data     │
   │        │         │            │<───────────│
   │        │         │            │            │
   │        │         │            │─┐          │
   │        │         │            │ │ format   │
   │        │         │            │ │ response │
   │        │         │            │<┘          │
   │        │         │            │            │
   │        │         │  JSON      │            │
   │        │         │<────────────│            │
   │        │         │            │            │
   │        │         │─┐          │            │
   │        │         │ │ update   │            │
   │        │         │ │ chart    │            │
   │        │         │<┘          │            │
   │        │         │            │            │
   │       ...       ...          ...          ...
   │        │         │            │            │
   │        │         │─┐          │            │
   │        │         │ │ 30s      │            │
   │        │         │ │ timer    │            │
   │        │         │<┘          │            │
   │        │         │            │            │
   │        │         │ GET (auto) │            │
   │        │         │────────────>│           │
   │        │         │            │──────────>│
   │        │         │            │<───────────│
   │        │         │<────────────│            │
   │        │         │            │            │
```

---

## Component Diagram

### 시스템 컴포넌트 구성

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         Satellite Monitoring System                      │
└─────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────┐
│                           Presentation Layer                             │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────────┐                    ┌──────────────────────┐    │
│  │   Nginx            │                    │   React Frontend     │    │
│  │   (Reverse Proxy)  │                    │   (SPA)              │    │
│  │                    │                    │                      │    │
│  │  Port: 80          │◄───────────────────┤  • TrendDashboard    │    │
│  │  Routes:           │                    │  • Charts (Recharts) │    │
│  │  • / → frontend    │                    │  • Dark Theme        │    │
│  │  • /api → backend  │                    └──────────────────────┘    │
│  └─────────┬──────────┘                                                 │
│            │                                                             │
└────────────┼─────────────────────────────────────────────────────────────┘
             │
┌────────────┼─────────────────────────────────────────────────────────────┐
│            │               Application Layer                             │
├────────────┼─────────────────────────────────────────────────────────────┤
│            ▼                                                             │
│  ┌──────────────────────┐         ┌──────────────────────────┐          │
│  │ Operation Server     │         │ Analysis Server          │          │
│  │ (FastAPI)            │         │ (Celery Worker)          │          │
│  │                      │         │                          │          │
│  │  Components:         │         │  Components:             │          │
│  │  ┌────────────────┐  │         │  ┌────────────────────┐ │          │
│  │  │ Inference API  │  │         │  │ Triton Client      │ │          │
│  │  └────────────────┘  │         │  └────────────────────┘ │          │
│  │  ┌────────────────┐  │         │  ┌────────────────────┐ │          │
│  │  │ Trends API     │  │         │  │ Task Processor     │ │          │
│  │  └────────────────┘  │         │  └────────────────────┘ │          │
│  │  ┌────────────────┐  │         │                          │          │
│  │  │ Query API      │  │         └──────────┬───────────────┘          │
│  │  └────────────────┘  │                    │                          │
│  └──────────┬───────────┘                    │                          │
│             │                                │                          │
└─────────────┼────────────────────────────────┼──────────────────────────┘
              │                                │
┌─────────────┼────────────────────────────────┼──────────────────────────┐
│             │          Data Processing Layer │                          │
├─────────────┼────────────────────────────────┼──────────────────────────┤
│             │                                │                          │
│  ┌──────────▼──────────┐        ┌───────────▼──────────────┐           │
│  │ Victoria Consumer   │        │ Triton Inference Server  │           │
│  │                     │        │                          │           │
│  │  Process:           │        │  Models:                 │           │
│  │  1. Consume Kafka   │        │  ┌────────────────────┐  │           │
│  │  2. Parse JSON      │        │  │ VAE Timeseries     │  │           │
│  │  3. Format Prom     │        │  │ (Python Backend)   │  │           │
│  │  4. Write VicMetrics│        │  └────────────────────┘  │           │
│  └─────────┬───────────┘        │  ┌────────────────────┐  │           │
│            │                    │  │ Transformer        │  │           │
│            │                    │  │ (Python Backend)   │  │           │
│            │                    │  └────────────────────┘  │           │
│            │                    └──────────────────────────┘           │
│            │                                                            │
└────────────┼────────────────────────────────────────────────────────────┘
             │
┌────────────┼────────────────────────────────────────────────────────────┐
│            │             Message Queue Layer                            │
├────────────┼────────────────────────────────────────────────────────────┤
│            ▼                                                            │
│  ┌──────────────────────────────────────────────────────────┐          │
│  │  Apache Kafka (KRaft Mode)                               │          │
│  │                                                           │          │
│  │  Topics:                                                 │          │
│  │  • satellite-telemetry    (Sensor Data)                  │          │
│  │  • inference.results      (Predictions)                  │          │
│  │  • __consumer_offsets     (System)                       │          │
│  └──────────────────────────────────────────────────────────┘          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                         Data Storage Layer                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────────┐ │
│  │ VictoriaMetrics  │  │ PostgreSQL       │  │ Redis                │ │
│  │ (Time-Series DB) │  │ (Relational DB)  │  │ (Cache/Queue)        │ │
│  │                  │  │                  │  │                      │ │
│  │  Stores:         │  │  Tables:         │  │  Uses:               │ │
│  │  • Telemetry     │  │  • Jobs          │  │  • Celery Broker     │ │
│  │  • Metrics       │  │  • Results       │  │  • Session Store     │ │
│  │                  │  │  • Logs          │  │  • Cache             │ │
│  └──────────────────┘  └──────────────────┘  └──────────────────────┘ │
│                                                                         │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │ Elasticsearch                                                    │  │
│  │ (Search Engine)                                                  │  │
│  │                                                                  │  │
│  │  Indexes:                                                        │  │
│  │  • Logs                                                          │  │
│  │  • Events                                                        │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                         Monitoring Layer                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────┐  ┌───────────────┐  ┌────────────────────────────┐ │
│  │ Kafka UI      │  │ Flower        │  │ RedisInsight               │ │
│  │ (Kafka Mon.)  │  │ (Celery Mon.) │  │ (Redis UI)                 │ │
│  └───────────────┘  └───────────────┘  └────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

                        Component Relationships:
                        ────────── HTTP/REST API
                        - - - - -  Kafka Messages
                        ············ Database Queries
```

---

## Deployment Diagram

### Docker Compose 배포 아키텍처

```
┌───────────────────────────────────────────────────────────────────────────┐
│                           Host Machine (Linux/WSL2)                        │
│                                                                            │
│  ┌──────────────────────────────────────────────────────────────────────┐ │
│  │                     Docker Engine                                    │ │
│  │                                                                      │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │                Docker Network: webnet (bridge)                │  │ │
│  │  │                                                               │  │ │
│  │  │  ┌─────────┐  ┌─────────┐  ┌──────────┐  ┌──────────────┐  │  │ │
│  │  │  │ nginx   │  │frontend │  │operation │  │triton-server │  │  │ │
│  │  │  │ :80     │  │ :3000   │  │ :8000    │  │:8500-8502    │  │  │ │
│  │  │  └────┬────┘  └────┬────┘  └────┬─────┘  └──────┬───────┘  │  │ │
│  │  │       │            │            │               │          │  │ │
│  │  │  ┌────┴────────────┴────────────┴───────────────┴──────┐  │  │ │
│  │  │  │                                                      │  │  │ │
│  │  │  │  ┌──────────┐  ┌─────────┐  ┌────────┐  ┌────────┐ │  │  │ │
│  │  │  │  │ kafka    │  │victoria │  │victoria│  │analysis│ │  │  │ │
│  │  │  │  │ :9092    │  │-metrics │  │-consumer  │-worker │ │  │  │ │
│  │  │  │  └────┬─────┘  │ :8428   │  └────────┘  └────────┘ │  │  │ │
│  │  │  │       │        └─────────┘                          │  │  │ │
│  │  │  │  ┌────┴────┐                                        │  │  │ │
│  │  │  │  │         │                                        │  │  │ │
│  │  │  │  │  ┌──────▼─────┐  ┌─────────┐  ┌────────────┐   │  │  │ │
│  │  │  │  │  │ postgres   │  │  redis  │  │elasticsearch  │  │  │ │
│  │  │  │  │  │ :5432      │  │ :6379   │  │ :9200      │   │  │  │ │
│  │  │  │  │  └────────────┘  └─────────┘  └────────────┘   │  │  │ │
│  │  │  │  │                                                  │  │  │ │
│  │  │  │  │  ┌──────────┐  ┌────────┐  ┌──────────────┐   │  │  │ │
│  │  │  │  │  │ kafka-ui │  │ flower │  │ redisinsight │   │  │  │ │
│  │  │  │  │  │ :8080    │  │ :5555  │  │ :8001        │   │  │  │ │
│  │  │  │  │  └──────────┘  └────────┘  └──────────────┘   │  │  │ │
│  │  │  │  └──────────────────────────────────────────────┘  │  │ │ │
│  │  │  └──────────────────────────────────────────────────┘  │  │ │
│  │  └──────────────────────────────────────────────────────────┘  │ │
│  │                                                                 │ │
│  │  ┌──────────────────────────────────────────────────────────┐  │ │
│  │  │                   Docker Volumes                          │  │ │
│  │  │                                                           │  │ │
│  │  │  • kafka_data       - Kafka logs & topics                │  │ │
│  │  │  • postgres_data    - PostgreSQL database files          │  │ │
│  │  │  • victoria_data    - VictoriaMetrics time-series data   │  │ │
│  │  │  • es_data          - Elasticsearch indexes              │  │ │
│  │  └──────────────────────────────────────────────────────────┘  │ │
│  └──────────────────────────────────────────────────────────────────┘ │
│                                                                        │
│  ┌──────────────────────────────────────────────────────────────────┐ │
│  │                    NVIDIA GPU (Optional)                         │ │
│  │                                                                  │ │
│  │  • Device: /dev/nvidia0                                         │ │
│  │  • Driver: NVIDIA Container Toolkit                            │ │
│  │  • Used by: triton-server (sm_100, RTX 5060)                   │ │
│  └──────────────────────────────────────────────────────────────────┘ │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘

                            External Clients
                                  │
                                  │ HTTP
                                  ▼
                         ┌──────────────────┐
                         │  Port Mapping    │
                         │                  │
                         │  80  → nginx     │
                         │  5432→ postgres  │
                         │  5555→ flower    │
                         │  6379→ redis     │
                         │  8000→ operation │
                         │  8001→ redisinsight
                         │  8080→ kafka-ui  │
                         │  8428→ victoria  │
                         │  8500→ triton    │
                         │  9092→ kafka     │
                         │  9200→ elastic   │
                         └──────────────────┘
```

---

## Activity Diagram

### 위성 데이터 수집 및 분석 프로세스

```
               START
                 │
                 ▼
       ┌─────────────────────┐
       │ 시뮬레이터 시작      │
       └──────────┬──────────┘
                  │
                  ▼
       ┌─────────────────────┐
       │ 궤도 상태 계산       │
       │ • 위치              │
       │ • 속도              │
       └──────────┬──────────┘
                  │
                  ▼
       ┌─────────────────────┐
       │ 센서 데이터 생성     │
       │ • 온도              │
       │ • 고도              │
       │ • 배터리            │
       │ • 태양광            │
       └──────────┬──────────┘
                  │
                  ▼
       ┌─────────────────────┐
       │ Kafka로 전송         │
       └──────────┬──────────┘
                  │
       ┌──────────┴──────────┐
       │                     │
       ▼                     ▼
┌──────────────┐    ┌──────────────────┐
│Victoria      │    │Operation Server  │
│Consumer      │    │                  │
│  │           │    │  │               │
│  ▼           │    │  ▼               │
│┌───────────┐ │    │┌────────────┐   │
││메시지 읽기│ │    ││API 요청 수신│  │
│└─────┬─────┘ │    │└──────┬─────┘   │
│      ▼       │    │       ▼         │
│┌───────────┐ │    │┌────────────┐   │
││Prometheus │ │    ││Celery Task │   │
││포맷 변환  │ │    ││생성        │   │
│└─────┬─────┘ │    │└──────┬─────┘   │
│      ▼       │    │       ▼         │
│┌───────────┐ │    │┌────────────┐   │
││Victoria   │ │    ││Analysis    │   │
││Metrics    │ │    ││Worker      │   │
││저장       │ │    │└──────┬─────┘   │
│└───────────┘ │    │       ▼         │
└──────────────┘    │┌────────────┐   │
                    ││Triton      │   │
                    ││추론        │   │
                    │└──────┬─────┘   │
                    │       ▼         │
                    │┌────────────┐   │
                    ││PostgreSQL  │   │
                    ││저장        │   │
                    │└────────────┘   │
                    └──────────────────┘
                           │
                           ▼
                  ┌─────────────────┐
                  │ 사용자가         │
                  │ 대시보드에서     │
                  │ 조회             │
                  └─────────┬───────┘
                            │
                            ▼
                  ┌─────────────────┐
                  │ API 호출         │
                  └─────────┬───────┘
                            │
                  ┌─────────┴─────────┐
                  │                   │
                  ▼                   ▼
        ┌──────────────┐    ┌──────────────┐
        │VictoriaMetrics    │PostgreSQL    │
        │쿼리          │    │쿼리          │
        │(원본 데이터) │    │(예측 데이터) │
        └──────┬───────┘    └──────┬───────┘
               │                   │
               └─────────┬─────────┘
                         │
                         ▼
                ┌─────────────────┐
                │ 차트 렌더링      │
                └─────────────────┘
                         │
                         ▼
                ┌─────────────────┐
                │ 30초 대기        │
                └─────────┬───────┘
                          │
                          │ 루프
                          └──────┐
                                 │
                                 ▼
                           (반복 조회)
```

---

## State Diagram

### 추론 작업 상태 다이어그램

```
                    ┌──────────┐
                    │  START   │
                    └─────┬────┘
                          │
                          │ submit()
                          ▼
                    ┌──────────┐
                ┌───│ PENDING  │
                │   └─────┬────┘
                │         │
                │         │ worker picks up
                │         ▼
                │   ┌─────────────┐
                │   │ PROCESSING  │◄──┐ retry
                │   └─────┬───────┘   │
                │         │           │
                │         │ error     │
         cancel()│    ┌───┴───┐       │
                │    │       │       │
                │    │       │       │
                └────┼──►┌───▼──────┐ │
                     │   │ FAILED   │ │
                     │   └──────────┘ │
                     │                │
                     │   ┌──────────┐ │
                     └──►│CANCELLED │ │
                         └──────────┘ │
                                      │
                         success      │
                            │         │
                            ▼         │
                       ┌──────────┐   │
                       │COMPLETED │   │
                       └────┬─────┘   │
                            │         │
                            │ ttl     │
                            │ expired │
                            ▼         │
                       ┌──────────┐   │
                       │ EXPIRED  │   │
                       └──────────┘   │
                            │         │
                            ▼         ▼
                       ┌──────────────┐
                       │   DELETED    │
                       └──────────────┘
                            │
                            ▼
                         [ END ]


State Descriptions:

• PENDING:     작업이 큐에 대기 중
• PROCESSING:  Worker가 추론 실행 중
• COMPLETED:   추론 완료, 결과 저장됨
• FAILED:      추론 실패 (에러 발생)
• CANCELLED:   사용자에 의해 취소됨
• EXPIRED:     TTL 만료 (결과 보존 기간 경과)
• DELETED:     DB에서 삭제됨

Transitions:

submit()       → PENDING
worker_pickup  → PROCESSING
success        → COMPLETED
error          → FAILED (→ retry → PROCESSING)
cancel()       → CANCELLED
ttl_expired    → EXPIRED
cleanup        → DELETED
```

---

## 추가 다이어그램

### 데이터 흐름 다이어그램 (DFD)

```
┌─────────────┐
│ Satellite   │
│ Simulator   │
└──────┬──────┘
       │ Telemetry
       │ (JSON)
       ▼
┌─────────────┐    ┌──────────────┐    ┌──────────────┐
│   Kafka     │───>│  Victoria    │───>│ Victoria     │
│   Broker    │    │  Consumer    │    │ Metrics      │
└─────────────┘    └──────────────┘    └──────┬───────┘
       │                                       │
       │ Inference                             │ PromQL
       │ Request                               │ Query
       ▼                                       ▼
┌─────────────┐    ┌──────────────┐    ┌──────────────┐
│ Operation   │───>│  Analysis    │───>│ PostgreSQL   │
│ Server      │    │  Worker      │    │              │
└─────────────┘    └──────┬───────┘    └──────────────┘
       │                  │ Inference          │
       │                  │ Request            │ Query
       │                  ▼                    │
       │           ┌──────────────┐            │
       └──────────>│    Triton    │            │
                   │    Server    │            │
                   └──────────────┘            │
                          │                    │
                          │ Model Output       │
                          └────────────────────┘
                                    │
                                    │ API Request
                                    ▼
                            ┌──────────────┐
                            │   Frontend   │
                            │  Dashboard   │
                            └──────────────┘
```

---

## 요약

이 문서는 인공위성 시계열 모니터링 시스템의 UML 다이어그램을 제공합니다:

✅ **Use Case Diagram**: 사용자와 시스템 기능 관계
✅ **Class Diagram**: 주요 클래스 구조 및 관계
✅ **Sequence Diagram**: 시간 흐름에 따른 객체 간 상호작용
✅ **Component Diagram**: 시스템 컴포넌트 구성
✅ **Deployment Diagram**: Docker 배포 아키텍처
✅ **Activity Diagram**: 비즈니스 프로세스 흐름
✅ **State Diagram**: 추론 작업 상태 전이

이 다이어그램들은 시스템의 구조, 동작, 배포 방식을 이해하는 데 도움이 됩니다.
